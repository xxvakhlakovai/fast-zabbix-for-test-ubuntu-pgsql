version: '3.5'
services:
 zabbix-server:
  image: zabbix/zabbix-server-pgsql:ubuntu-5.4-latest
  environment:
   DB_SERVER_HOST: pgsql-server
   PGSQL_DATABASE: zabbix
   PGSQL_USER: zabbix
   PGSQL_PASSWORD: zabbix
  ports:
   - '10051:10051'
  restart: always
  links:
   - postgres-server
  depends_on:
   - postgres-server
  networks:
   zbx_net_backend:
     aliases:
      - zabbix-server
      - zabbix-server-pgsql
      - zabbix-server-ubuntu-pgsql
      - zabbix-server-pgsql-ubuntu
   zbx_net_frontend:
   
 postgres-server:
  image: postgres:13-alpine
  environment:
   PGSQL_ROOT_PASSWORD: root_pwd
   PGSQL_DATABASE: zabbix
   PGSQL_USER: zabbix
   PGSQL_PASSWORD: zabbix
  ports:
   - '1433:1433'
  restart: always
  volumes:
   - ./src/pgsql:/var/lib/pgsql
  command: ['pgsql', '--character-set-server=utf8', '--collation-server=utf8_bin']
  networks:
   zbx_net_backend:
    aliases:
     - postgres-server
     - pgsql-server
     - pgsql-database
  
 zabbix-web:
    image: zabbix/zabbix-web-nginx-pgsql:ubuntu-5.4-latest
    container_name: zabbix-web
    environment:
      PGSQL_ROOT_PASSWORD: root_pwd
      PGSQL_USER: zabbix
      PGSQL_PASSWORD: zabbix
      ZBX_SERVER_HOST: zabbix-server
      PHP_TZ: Europe/Moscow
    ports:
      - '80:80'
      - '443:443'
    restart: always
    links: 
      - zabbix-server
    depends_on:
      - zabbix-server
    networks:
     zbx_net_backend:
     aliases:
      - zabbix-web-service
      - zabbix-web-service-ubuntu

networks:
  zbx_net_frontend:
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: "false"
    ipam:
      driver: default
      config:
      - subnet: 172.16.238.0/24
  zbx_net_backend:
    driver: bridge
    driver_opts:
      com.docker.network.enable_ipv6: "false"
    internal: true
    ipam:
      driver: default
      config:
      - subnet: 172.16.239.0/24
